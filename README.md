# Vueå…¨å®¶æ¡¶+Socket.io+Express/Koa2æ‰“é€ ç½‘é¡µç‰ˆæ‰‹æœºQQ

Vueå…¨å®¶æ¡¶+Socket.io+Express/Koa2æ‰“é€ çš„ç½‘é¡µç‰ˆæ‰‹æœºQQ ,é«˜ä»¿æ‰‹æœºQQ7.1.0ç‰ˆæœ¬

## é¢„è§ˆ

åœ¨çº¿é¢„è§ˆåœ°å€ï¼šğŸ‘‰ https://lenshen.com/vue-qq/

## æŠ€æœ¯æ ˆ
* **Vue2.0**ï¼šå‰ç«¯MVVMæ¡†æ¶ï¼Œå®ç°å•é¡µSPAåº”ç”¨
* **Vuex**ï¼šå®ç°ä¸åŒç»„ä»¶é—´çš„çŠ¶æ€å…±äº«
* **Vue-router**ï¼šé¡µé¢è·¯ç”±åˆ‡æ¢
* **vueg**ï¼šé¡µé¢åœºæ™¯åˆ‡æ¢æ•ˆæœ
* **Socket.io**ï¼šå®ç°å®æ—¶æ¶ˆæ¯æ¨é€
* **axios**ï¼šä¸€ä¸ªåŸºäº `Promise` çš„ HTTP åº“ï¼Œå‘åç«¯å‘èµ·è¯·æ±‚
* **Express**ã€**Koa2**ï¼šå› ä¸ºvue-cliç”Ÿæˆçš„é¡¹ç›®æ˜¯åŸºäº**express**çš„ï¼Œæ‰€ä»¥åœ¨å¼€å‘é˜¶æ®µæˆ‘ä½¿ç”¨çš„æ˜¯å®ƒï¼Œä½†æ˜¯çœŸæ­£ä¸Šçº¿ç”Ÿäº§ç¯å¢ƒæˆ‘æ¢æˆäº†**Koa2**
* **ES6**ã€**ES7**ã€**ES8**ï¼šæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å‡ä½¿ç”¨ES6è¯­æ³•ï¼Œpromise/async/await å¤„ç†å¼‚æ­¥
* **localStorage**ï¼šæœ¬åœ°ä¿å­˜ç”¨æˆ·ä¿¡æ¯
* **Webpack**ï¼švue-cliè‡ªå¸¦Webpackï¼Œä½†æ˜¯éœ€è¦è‡ªå·±æ”¹é€ ä¸€ä¸‹ï¼Œæ¯”å¦‚è¦å¯¹éœ€è¦å®‰è£…sassç›¸å…³loaderï¼Œvue-cliå·²ç»é…ç½®å¥½äº†webpackï¼Œä½ åªéœ€è¦å®‰è£…ä¾èµ–å°±å¯ä»¥ï¼Œä½¿ç”¨çš„æ—¶å€™åªéœ€è¦`<style lang="scss"></style>`
* **SASS**(**SCSS**)ï¼šç”¨SCSSåšCSSé¢„å¤„ç†è¯­è¨€
* **Flex**ï¼šflexå¼¹æ€§å¸ƒå±€ï¼Œç®€å•é€‚é…æ‰‹æœºã€PCç«¯
* **CSS3**ï¼šCSS3è¿‡æ¸¡åŠ¨ç”»åŠæ ·å¼
* **IScroll5**ï¼šç§»åŠ¨ç«¯æ»šåŠ¨æ¡æ•ˆæœ
* **MySQL**ï¼šMySQLå…³ç³»å‹æ•°æ®åº“æŒä¹…åŒ–æ•°æ®ï¼ˆè€ƒè™‘åˆ°è¡¨ä¸è¡¨ä¹‹é—´å…³ç³»å¤æ‚ï¼Œéœ€è¦å¤šè¡¨æŸ¥è¯¢ï¼Œæœ€å¤æ‚çš„æ—¶å€™æ˜¯å…­å¼ è¡¨è”æŸ¥ï¼Œç”¨MySQLä¼šæ¯”Mongodbå¥½å¾—å¤šï¼‰
* **jsonp**ï¼šè·¨åŸŸè¯·æ±‚æ•°æ®

## åˆ†æ

* ### æœåŠ¡ç«¯ä½¿ç”¨ES6è¯­æ³•

ä¸éœ€è¦ä½¿ç”¨babelè½¬ç ä»¥åŠä¸€ç³»åˆ—çš„é…ç½®ï¼Œåªéœ€è¦å°†nodeå‡çº§åˆ°V8ç‰ˆæœ¬ï¼ŒV8å·²ç»å¾ˆå¥½åœ°æ”¯æŒäº†ES6/ES7/ES8ç­‰æœ€æ–°ç‰¹æ€§ï¼Œè¿™æ˜¯ç›®å‰æœ€å¥½çš„åŠæ³•ã€‚å‡çº§åˆ°V8ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥åˆ°nodejsä¸­æ–‡ç½‘(http://nodejs.cn/download/) ä¸‹è½½å³å¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨NVMåˆ‡æ¢nodeç‰ˆæœ¬ã€‚
å‡çº§åˆ°V8åï¼Œè¿˜ä¸æ”¯æŒé€šè¿‡import/exportå…³é”®å­—æ¥å¯¼å…¥å¯¼å‡ºæ¨¡å—(å› ä¸ºæœåŠ¡ç«¯å·²ç»æœ‰äº†CommonJSè§„èŒƒï¼Œå¦‚æœå†ä½¿ç”¨import/exportçš„è¯å°±æœ‰ç‚¹å†²çªäº†)ï¼Œå¦‚æœä¸€å®šè¦ä½¿ç”¨import/exportå…³é”®å­—ä¸€å®šè¿™æ—¶å¯ä»¥åœ¨æœåŠ¡ç«¯çš„å…¥å£æ–‡ä»¶é¦–è¡Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```javascript
require("babel-core/register")({
	presets: ['es2015', 'stage-0']
});
require("babel-polyfill")
```

ä¸Šé¢çš„ä»£ç ä¸å¯ä»¥ä½¿ç”¨importæ¥å¯¼å…¥ï¼Œå¿…é¡»ä½¿ç”¨requireï¼ŒåŒæ—¶éœ€è¦é€šè¿‡npmå®‰è£…babel-coreã€babel-preset-es2015ã€babel-preset-stage-0ã€babel-polyfillç­‰ä¾èµ–ã€‚è¿™æ ·å°±å¯ä»¥æ„‰å¿«åœ°ä½¿ç”¨import/exportäº†ã€‚
æœåŠ¡ç«¯ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š

``` javascript
// ES6 import/export
import express from 'express'
import loginRouter from './router/login'
import registerRouter from './router/register'
import friendRouter from './router/friend'
import messageRouter from './router/message'
import userRouter from './router/user'

const apiRouter = express.Router()

apiRouter
	.use('/login', loginRouter)
	.use('/register', registerRouter)
	.use('/friend', friendRouter)
	.use('/message', messageRouter)
	.use('/user', userRouter)

export default apiRouter
```

``` javascript
// ES7/ES8 async/await
import express from 'express'
import login from '../../controller/login'

const loginRouter = express.Router()

loginRouter
	.get('/:user/:pwd', async(req, res) => { // ç™»å½•
		const result = await login.login(req, res)
		res.json(result)
	})

export default loginRouter
```

* ### Socket.io
é€šè¿‡Express/Koaåœ¨æœåŠ¡ç«¯å¯ä»¥è¿™æ ·åš:

```javascript
// Server (app.js)

var app = require('express')()
var server = require('http').Server(app)
var io = require('socket.io')(server)

server.listen(80)

app.get('/', function (req, res) {
  res.sendfile(__dirname + '/index.html')
})

io.on('connection', function (socket) {
  socket.emit('news', { hello: 'world' })
  socket.on('my other event', function (data) {
    console.log(data)
  })
})
```

å®¢æˆ·ç«¯ä»£ç 

```javascript
// Client (index.html)

<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io.connect('http://localhost')
  socket.on('news', function (data) {
    console.log(data)
    socket.emit('my other event', { my: 'data' })
  })
</script>
```

ä¸ç®¡æ˜¯æœåŠ¡å™¨è¿˜æ˜¯å®¢æˆ·ç«¯éƒ½æœ‰ `emit` å’Œ `on` è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå¯ä»¥è¯´ socket.io çš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°äº†ï¼Œé€šè¿‡ `emit` å’Œ `on` å¯ä»¥è½»æ¾åœ°å®ç°æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„åŒå‘é€šä¿¡ã€‚

`emit` ï¼šç”¨æ¥å‘å°„ä¸€ä¸ªäº‹ä»¶æˆ–è€…è¯´è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºäº‹ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦å‘é€çš„æ•°æ®ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼ˆä¸€èˆ¬çœç•¥ï¼Œå¦‚éœ€å¯¹æ–¹æ¥å—åˆ°ä¿¡æ¯åç«‹å³å¾—åˆ°ç¡®è®¤æ—¶ï¼Œåˆ™éœ€è¦ç”¨åˆ°å›è°ƒå‡½æ•°ï¼‰ã€‚
`on` ï¼šç”¨æ¥ç›‘å¬ä¸€ä¸ª emit å‘å°„çš„äº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦ç›‘å¬çš„äº‹ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªåŒ¿åå‡½æ•°ç”¨æ¥æ¥æ”¶å¯¹æ–¹å‘æ¥çš„æ•°æ®ï¼Œè¯¥åŒ¿åå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ¥æ”¶çš„æ•°æ®ï¼Œè‹¥æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™ä¸ºè¦è¿”å›çš„å‡½æ•°ã€‚
socket.io æä¾›äº†ä¸‰ç§é»˜è®¤çš„äº‹ä»¶ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æœ‰ï¼‰ï¼š`connect` ã€`message` ã€`disconnect` ã€‚å½“ä¸å¯¹æ–¹å»ºç«‹è¿æ¥åè‡ªåŠ¨è§¦å‘ `connect` äº‹ä»¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹å‘æ¥çš„æ•°æ®åè§¦å‘ `message` äº‹ä»¶ï¼ˆé€šå¸¸ä¸º `socket.send()` è§¦å‘ï¼‰ï¼Œå½“å¯¹æ–¹å…³é—­è¿æ¥åè§¦å‘ `disconnect` äº‹ä»¶ã€‚

æ­¤å¤–ï¼Œsocket.io è¿˜æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ¯•ç«Ÿä»¥ä¸Šä¸‰ç§äº‹ä»¶åº”ç”¨èŒƒå›´æœ‰é™ï¼Œæ­£æ˜¯é€šè¿‡è¿™äº›è‡ªå®šä¹‰çš„äº‹ä»¶æ‰å®ç°äº†ä¸°å¯Œå¤šå½©çš„é€šä¿¡ã€‚

æœ€åï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯åŒºåˆ†ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š

`socket.emit()` ï¼šå‘å»ºç«‹è¯¥è¿æ¥çš„å®¢æˆ·ç«¯å¹¿æ’­
`socket.broadcast.emit()` ï¼šå‘é™¤å»å»ºç«‹è¯¥è¿æ¥çš„å®¢æˆ·ç«¯çš„æ‰€æœ‰å®¢æˆ·ç«¯å¹¿æ’­
`io.sockets.emit()` ï¼šå‘æ‰€æœ‰å®¢æˆ·ç«¯å¹¿æ’­ï¼Œç­‰åŒäºä¸Šé¢ä¸¤ä¸ªçš„å’Œ

## About
å…³äºæˆ‘ï¼šğŸ‘‰https://lenshen.com/about
GitHubï¼šğŸ‘‰ https://github.com/lensh